{% extends 'base.html' %}
{% load static %}

{% block title %}{{ inmueble.titulo }} - InmueblesApp{% endblock %}

{% block content %}
<div class="container mt-4">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{% url 'inmuebles:listar' %}">Inmuebles</a></li>
            <li class="breadcrumb-item active">{{ inmueble.titulo }}</li>
        </ol>
    </nav>

    <div class="row">
        <div class="col-lg-8">
            <!-- Galería de imágenes -->
            <div class="card mb-4">
                <div class="card-body">
                    {% if inmueble.imagen_principal %}
                    <img src="{{ inmueble.imagen_principal.imagen.url }}" 
                         class="img-fluid rounded mb-3" 
                         alt="{{ inmueble.titulo }}"
                         style="width: 100%; max-height: 500px; object-fit: cover;">
                    {% else %}
                    <div class="bg-secondary d-flex align-items-center justify-content-center rounded mb-3" 
                         style="height: 400px;">
                        <i class="fas fa-building fa-5x text-white"></i>
                    </div>
                    {% endif %}

                    <!-- Miniaturas -->
                    {% if inmueble.imagenes.count > 1 %}
                    <div class="row">
                        {% for imagen in inmueble.imagenes.all %}
                        <div class="col-3 mb-2">
                            <img src="{{ imagen.imagen.url }}" 
                                 class="img-thumbnail" 
                                 alt="{{ imagen.descripcion }}"
                                 style="cursor: pointer; height: 80px; object-fit: cover; width: 100%;">
                        </div>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Descripción -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5><i class="fas fa-info-circle"></i> Descripción</h5>
                </div>
                <div class="card-body">
                    <p>{{ inmueble.descripcion|linebreaks }}</p>
                </div>
            </div>

            <!-- Características -->
            <div class="card">
                <div class="card-header">
                    <h5><i class="fas fa-list"></i> Características</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6 mb-2">
                            <i class="fas fa-bed text-primary"></i> 
                            <strong>Habitaciones:</strong> {{ inmueble.habitaciones }}
                        </div>
                        <div class="col-md-6 mb-2">
                            <i class="fas fa-bath text-primary"></i> 
                            <strong>Baños:</strong> {{ inmueble.banos }}
                        </div>
                        <div class="col-md-6 mb-2">
                            <i class="fas fa-car text-primary"></i> 
                            <strong>Parqueaderos:</strong> {{ inmueble.parqueaderos }}
                        </div>
                        <div class="col-md-6 mb-2">
                            <i class="fas fa-expand text-primary"></i> 
                            <strong>Área:</strong> {{ inmueble.area }}m²
                        </div>
                        <div class="col-md-6 mb-2">
                            <i class="fas fa-layer-group text-primary"></i> 
                            <strong>Estrato:</strong> {{ inmueble.estrato|default:"No especificado" }}
                        </div>
                        <div class="col-md-6 mb-2">
                            <i class="fas fa-building text-primary"></i> 
                            <strong>Piso:</strong> {{ inmueble.piso|default:"N/A" }}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Información lateral -->
        <div class="col-lg-4">
            <!-- Precio -->
            <div class="card mb-4">
                <div class="card-body text-center">
                    <h3 class="text-primary mb-3">
                        ${{ inmueble.precio_arriendo|floatformat:0 }}
                    </h3>
                    <p class="text-muted">Precio mensual</p>
                    
                    {% if inmueble.precio_administracion %}
                    <p class="mb-2">
                        <small>+ ${{ inmueble.precio_administracion|floatformat:0 }} Administración</small>
                    </p>
                    {% endif %}
                    
                    <hr>
                    <h4 class="text-success">
                        ${{ inmueble.get_precio_total|floatformat:0 }}
                    </h4>
                    <p class="text-muted mb-0">Total mensual</p>
                </div>
            </div>

            <!-- Ubicación -->
            <div class="card mb-4">
                <div class="card-header">
                    <h6><i class="fas fa-map-marker-alt"></i> Ubicación</h6>
                </div>
                <div class="card-body">
                    <p class="mb-1"><strong>Dirección:</strong></p>
                    <p class="text-muted">{{ inmueble.direccion }}</p>
                    <p class="mb-1"><strong>Ciudad:</strong></p>
                    <p class="text-muted">{{ inmueble.ciudad }}</p>
                    {% if inmueble.barrio %}
                    <p class="mb-1"><strong>Barrio:</strong></p>
                    <p class="text-muted">{{ inmueble.barrio }}</p>
                    {% endif %}
                </div>
            </div>

            <!-- Información del propietario -->
            <div class="card mb-4">
                <div class="card-header">
                    <h6><i class="fas fa-user"></i> Propietario</h6>
                </div>
                <div class="card-body">
                    <p><strong>{{ inmueble.propietario.get_full_name }}</strong></p>
                    <p class="text-muted">{{ inmueble.propietario.email }}</p>
                    
                    {% if user.is_authenticated and user.tipo_usuario == 'inquilino' and inmueble.estado == 'disponible' %}
                    <button class="btn btn-success w-100">
                        <i class="fas fa-envelope"></i> Contactar
                    </button>
                    {% endif %}
                </div>
            </div>

            <!-- Estado -->
            <div class="card">
                <div class="card-body text-center">
                    {% if inmueble.estado == 'disponible' %}
                    <span class="badge bg-success fs-5">
                        <i class="fas fa-check-circle"></i> Disponible
                    </span>
                    {% elif inmueble.estado == 'arrendado' %}
                    <span class="badge bg-warning fs-5">
                        <i class="fas fa-exclamation-circle"></i> Arrendado
                    </span>
                    {% else %}
                    <span class="badge bg-secondary fs-5">
                        {{ inmueble.get_estado_display }}
                    </span>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
